<!DOCTYPE HTML>
<!--
	Solution for SLAE question #1

-->
<html>
	<head>
		<link rel="icon" href="../images/favicon.ico">
		<title>The Post</title>
		<meta charset="utf-8" />
		<meta name="viewport" content="width=device-width, initial-scale=1, user-scalable=no" />
		<link rel="stylesheet" href="../assets/css/main.css" />
		<link rel="stylesheet" href="../assets/css/atom-one-dark-reasonable.min.css">
		<script src="../assets/js/highlight.pack.js"></script>
		<script>hljs.initHighlightingOnLoad();</script>
		<noscript><link rel="stylesheet" href="../assets/css/noscript.css" /></noscript>
	</head>
	<body class="is-preload">

		<!-- Wrapper -->
			<div id="wrapper">

				<!-- Header -->
					<header id="header">
						<a class="logo">The Defense</a>
					</header>

				<!-- Nav -->
					<nav id="nav">
						<ul class="links">
							<li><a href="../index.html">Home</a></li>
							<li class="active"><a href="../posts.html">Posts</a></li>
							<li><a href="../research.html">Research</a></li>
							<li><a href="../stories.html">Stories</a></li>
							<li><a href="../references.html">Links</a></li>
						</ul>
						<ul class="icons">
							<li><a href="mailto:jpc0016@uah.edu" class="icon fa-paper-plane-o" target="_blank"><span class="label">Gmail</span></a></li>
							<li><a href="https://github.com/jpc0016" class="icon fa-github" target="_blank"><span class="label">GitHub</span></a></li>
							<li><a href="https://twitter.com/JohnGuy_01" class="icon fa-twitter" target="_blank"><span class="label">Twitter</span></a></li>
							<li><a href="https://stackoverflow.com/users/11770689/jpc0016?tab=profile" class="icon fa-stack-overflow" target="_blank"><span class="label">StackOverflow</span></a></li>
						</ul>
					</nav>

				<!-- Main -->
					<div id="main">
						<div class="wrapper">

						<!-- Post -->

                  <section class="post">
                    <body>
                      <article id="first-post">
												<a href="index.html"><img src="../images/chirs.png" class="avatar" alt="avatar"> </img></a>
                        <h2>&emsp; Creating Shell_Bind_TCP Shellcode </h2>
												<h5>&emsp; &emsp; &emsp; &emsp; September 18, 2020</h5>
                        <div class="box">
                          <p>
														&emsp; &emsp;This post involves writing shellcode to create a <i>Bind TCP</i> shell on a victim machine. &nbsp;This is also known as
														<i>port-binding shellcode</i>. &nbsp;Before continuing high-level analysis, it is worth noting the difference between
														bind and reverse TCP shells:<br><br>
														A bind shell is a command line interface opened when an attacker machine opens a port on the victim machine and connects to it. &nbsp;
														The victim machine listens to incoming connections and the attacker machine makes the connection. &nbsp;This is typically done
														using IP address 0.0.0.0 to denote listening on all interfaces. &nbsp;A diagram of a bind TCP shell is shown below.
											 	</p>
												<center><div class="image post"><img src="../images/slae/bind-shell.png" alt="" /></div></center><br>
												<br>

												<p>
													Reverse shells are functionally similar to bind shells but work in the opposite direction. &nbsp;Instead, the attacker machine listens
													for incoming connections from the vicitim machine over a preconfigured port (such as 4444). &nbsp;The connection attempt is initiated by the victim
													machine, usually by invoking a reverse shell. &nbsp;Below is what a reverse TCP shell looks like.
												</p>
												<center><div class="image post"><img src="../images/slae/reverse-shell.png" alt="" /></div></center><br>


												<br><h2>Drafting the Proof of Concept</h2>

												<p>
													&emsp; &emsp;It is important to visualize what a bind shell looks like in higher level objective C code before attempting to write it in x86 assembly. &nbsp;The tool, <i>libemu</i> has a component
													called <i>sctest</i> (shellcode test) that analyzes payloads to reveal useful information. &nbsp;Using it with <i>msfvenom</i> shows the main functions used in an unstaged bind shell payload.
													 &nbsp;Below is the output of the command <code>msfvenom -p linux/x86/shell_bind_tcp R | ~/SLAE/Libemu/tools/sctest/sctest -vvv -Ss 100000</code>
												</p>

												<pre>
													<code class="c-like" style=display:block;white-space:pre-wrap>
-- snip --

int socket (
     int domain = 2;
     int type = 1;
     int protocol = 0;
) =  14;
int bind (
     int sockfd = 14;
     struct sockaddr_in * my_addr = 0x00416fc2 =>
         struct   = {
             short sin_family = 2;
             unsigned short sin_port = 23569 (port=4444);
             struct in_addr sin_addr = {
                 unsigned long s_addr = 0 (host=0.0.0.0);
             };
             char sin_zero = "       ";
         };
     int addrlen = 16;
) =  0;
int listen (
     int s = 14;
     int backlog = 0;
) =  0;
int accept (
     int sockfd = 14;
     sockaddr_in * addr = 0x00000000 =>
         none;
     int addrlen = 0x00000010 =>
         none;
) =  19;
int dup2 (
     int oldfd = 19;
     int newfd = 14;
) =  14;

 -- snip --

int dup2 (
     int oldfd = 19;
     int newfd = 0;
) =  0;
int execve (
     const char * dateiname = 0x00416fb2 =>
           = "/bin//sh";
     const char * argv[] = [
           = 0x00416faa =>
               = 0x00416fb2 =>
                   = "/bin//sh";
           = 0x00000000 =>
             none;
     ];
     const char * envp[] = 0x00000000 =>
         none;
) =  0;
													</code>
												</pre>


												<p>
													From here you can see the functions <i>socket()</i>, <i>bind()</i>, <i>listen()</i>, <i>accept()</i>, <i>dup2()</i>, and <i>execve()</i> are primary drivers of the
													payload. &nbsp;Conveniently it also displays parameters used along with their values. &nbsp;It takes some googling and reading Linux man-pages
													(like <a href="https://man7.org/linux/man-pages/man2/bind.2.html" target="_blank" style="color:blue;">this one</a>) to
													get a general idea of what libraries to include, where to find them, and what parameters does each function need. &nbsp;Below is the resultant PoC:
												</p>


												<pre>
													<code class="c-like" style=display:block;white-space:pre-wrap>
#include &lt;stdio.h>
#include &lt;netinet/in.h>
#include &lt;sys/types.h>
#include &lt;sys/socket.h>
#include &lt;unistd.h>
													</code>
												</pre>

												<p>
													The above code looks very similar to what is found in server side socket code.
												</p>





												<br><h2>Assembly Code Creation</h2>

												<p>
													Assembly code goes here.
												</p>


												<br><h2>Demonstration</h2>

												<p>
													Demonstrate shellcode here in test case
												</p>


												<br><h2>Final Thoughts</h2>

												<p>
													Conclusion and stuff
										 		</p>

                         <p>The source code for this assignment as well as other SLAE assignments is here:
												 <a href="https://github.com/jpc0016/SLAE-code" target="_blank" style="color:blue;">https://github.com/jpc0016/SLAE-code</a>
											 		</p>





												 This blog post has been created for completing the requirements of the SecurityTube Linux Assembly Expert (SLAE) certification:
												 <a href="http://securitytube-training.com/online-courses/securitytube-linux-assembly-expert/" target="_blank" style="color:blue;">http://securitytube-training.com/online-courses/securitytube-linux-assembly-expert/</a><br><br>
												 Student ID: SLAE-XXXXX<br><br>

                        </div>

                      </article>
                    </body>
                  </section>








									<!--
									End post body
									-->

									<!--
									NEW POSTS GO ABOVE THIS LINE
									-->






									<!-- Remove Pagination
							<div class="pagination"><a href="#"> 1 </a></div>
							<div class="pagination"><a href="#"> 2 </a></div>
							<div class="pagination"><a href="#"> 3 </a></div>
							<div class="pagination"><a href="#"> 4 </a></div>
							<div class="pagination"><a href="#"> 5 </a></div>-->
							</div>
					</div>

				<!-- Footer -->
					<footer id="footer">

						<section class="split contact">

							<section>
								<h3>Social</h3>
								<ul class="icons alt">
									<li><a href="mailto:jpc0016@uah.edu" class="icon fa-paper-plane-o" target="_blank"><span class="label">Gmail</span></a></li>
									<li><a href="https://github.com/jpc0016" class="icon fa-github" target="_blank"><span class="label">GitHub</span></a></li>
									<li><a href="https://twitter.com/JohnGuy_01" class="icon fa-twitter" target="_blank"><span class="label">Twitter</span></a></li>
									<li><a href="https://stackoverflow.com/users/11770689/jpc0016?tab=profile" class="icon fa-stack-overflow" target="_blank"><span class="label">StackOverflow</span></a></li>
								</ul>
							</section>
						</section>
					</footer>

				<!-- Copyright -->
					<div id="copyright">
						<ul><li>&copy; Untitled</li><li>Design: <a href="https://html5up.net" target="_blank">HTML5 UP</a></li></ul>
					</div>

			</div>

		<!-- Scripts -->
			<script src="assets/js/jquery.min.js"></script>
			<script src="assets/js/jquery.scrollex.min.js"></script>
			<script src="assets/js/jquery.scrolly.min.js"></script>
			<script src="assets/js/browser.min.js"></script>
			<script src="assets/js/breakpoints.min.js"></script>
			<script src="assets/js/util.js"></script>
			<script src="assets/js/main.js"></script>

	</body>
</html>
